<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Carta interactiva — 9 meses</title>
<style>
  /* =======================
     Theme variables
     ======================= */
  :root{
    --bg-1: #0b1020;
    --bg-2: #0f1724;
    --paper: #fff9f4;
    --accent: #ff6b8a;
    --accent-2: #ff9db0;
    --muted: #7b7f88;
    --glass: rgba(255,255,255,0.04);
    --radius: 18px;
    --transition: 420ms cubic-bezier(.2,.95,.15,1);
    --max-width: 980px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;-webkit-font-smoothing:antialiased;color:#e9eef6;background:linear-gradient(180deg,var(--bg-1),var(--bg-2));}

  /* =======================
     Layout
     ======================= */
  .container{max-width:var(--max-width);margin:28px auto;padding:18px;display:grid;grid-template-columns:1fr 380px;gap:24px;align-items:start;}
  @media (max-width:900px){ .container{grid-template-columns:1fr; padding:14px;} .side{order:2} }

  /* =======================
     Scene: envelope + paper
     ======================= */
  .scene{display:flex;align-items:center;justify-content:center;padding:28px;}
  .env-wrap{width:420px;max-width:92vw;perspective:1400px;position:relative;}
  .envelope{
    width:360px;height:240px;position:relative;transform-style:preserve-3d;
    margin:auto;border-radius:16px;cursor:pointer;
    transition:transform var(--transition), box-shadow var(--transition);
    box-shadow: 0 20px 50px rgba(3,6,12,0.65);
  }

  /* Envelope body */
  .env-body{
    position:absolute;left:0;right:0;bottom:0;top:0;border-radius:16px;
    background: linear-gradient(180deg,#fffefb,#fff8f3);
    overflow:hidden;transform:translateZ(2px);
    display:flex;align-items:center;justify-content:center;
  }

  /* Flap (3D) */
  .env-flap{
    position:absolute;left:0;right:0;top:-18%;
    height:56%;margin:auto;width:92%;
    background:linear-gradient(180deg,#fff2f0,#ffecec);
    border-radius:12px;transform-origin:top center;
    transform: rotateX(0deg);transition:transform var(--transition);
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
  }

  /* Inner paper (the letter) */
  .paper{
    width:86%;height:74%;background:var(--paper);border-radius:10px;padding:18px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.18);transform:translateY(32px);
    opacity:0;transition:all 360ms cubic-bezier(.2,.9,.2,1);
    display:flex;flex-direction:column;gap:8px;position:relative;z-index:2;
  }

  /* When open state */
  .envelope.open .env-flap{ transform: rotateX(-185deg) translateY(-6px) }
  .envelope.open .paper{ transform:translateY(6px); opacity:1 }

  /* subtle paper texture via SVG filter (applied to .paper background using inline svg) */
  .paper .pages{position:relative;flex:1;display:block;overflow:hidden}

  /* pages */
  .page{position:absolute;inset:0;padding:6px 10px;display:flex;flex-direction:column;align-items:flex-start;justify-content:flex-start;opacity:0;transform:translateY(8px) scale(.998);transition:all 420ms cubic-bezier(.2,.95,.15,1);}
  .page.active{opacity:1;transform:translateY(0) scale(1)}
  .page h2{margin:6px 0 0 0;color:var(--accent);font-size:18px;letter-spacing:0.2px}
  .page p{margin:6px 0;color:#2b2b2b;line-height:1.5;font-size:15px}
  .page .doodles{margin-top:8px;display:flex;gap:10px;flex-wrap:wrap}

  /* navigation dots + arrows */
  .pager{display:flex;gap:8px;align-items:center;justify-content:center;padding-top:10px}
  .dot{width:10px;height:10px;border-radius:50%;background:var(--glass);border:1px solid rgba(255,255,255,0.04);cursor:pointer;transition:transform 180ms}
  .dot.active{background:linear-gradient(90deg,var(--accent),var(--accent-2));transform:scale(1.18)}
  .page-nav{display:flex;gap:10px;align-items:center;justify-content:center;margin-top:10px}

  /* side panel */
  .side{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:var(--radius);padding:18px;backdrop-filter:blur(6px);box-shadow:0 6px 30px rgba(0,0,0,0.45)}
  .side h3{margin:0;color:#fff}
  .side p{color:var(--muted);margin:8px 0 14px 0}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:12px;border:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white;font-weight:700;cursor:pointer}
  .ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#e6e8ee;padding:10px 12px;border-radius:12px;cursor:pointer}

  /* small icons */
  .icons{display:flex;gap:8px;margin-top:8px}

  /* hearts / confetti */
  .particles{position:absolute;inset:auto;pointer-events:none;z-index:60}
  .heart{position:absolute;width:22px;height:22px;opacity:0;transform:translateY(6px) scale(.7);animation:heartpop 1400ms forwards}
  @keyframes heartpop{
    0%{opacity:0;transform:translateY(10px) scale(.6)}
    30%{opacity:1;transform:translateY(-8px) scale(1.06)}
    100%{opacity:0;transform:translateY(-140px) scale(.8)}
  }

  /* sparkle cursor */
  .spark{position:fixed;pointer-events:none;z-index:9999;mix-blend-mode:screen;width:12px;height:12px;border-radius:50%;background:radial-gradient(circle,#fff,#fff0 40%,transparent 60%);opacity:0.95;transform:translate(-50%,-50%);}

  /* signature reveal (mask wipe) */
  .signature{font-family: "Brush Script MT", "Segoe Script", cursive;font-size:20px;color:#b24b6d;display:inline-block;position:relative;overflow:hidden;}
  .signature .wipe{position:absolute;left:0;top:0;height:100%;width:100%;background:linear-gradient(90deg,transparent 0%, rgba(255,255,255,0.95) 48%, transparent 52%);transform:translateX(-105%);pointer-events:none;transition:transform 1200ms cubic-bezier(.2,.9,.3,1)}
  .signature.revealed .wipe{transform:translateX(105%)}

  /* accessibility: reduce motion */
  @media (prefers-reduced-motion: reduce){
    *{transition:none!important;animation:none!important}
    .paper{opacity:1;transform:none}
  }

  /* small polish */
  code{background:rgba(255,255,255,0.03);padding:3px 6px;border-radius:6px;color:#fff;font-size:12px}
  .meta{font-size:13px;color:var(--muted)}
</style>
</head>
<body>
<div class="container">
  <!-- LEFT: Scene -->
  <div>
    <div class="scene">
      <div class="env-wrap">
        <div id="envelope" class="envelope" role="button" aria-pressed="false" tabindex="0" aria-label="Abrir carta">
          <div class="env-flap" aria-hidden="true"></div>
          <div class="env-body" aria-hidden="true">
            <!-- paper -->
            <div class="paper" id="paper" aria-live="polite" aria-atomic="true">
              <div class="pages">
                <!-- PAGE 1: PORTADA -->
                <div class="page page-0 active" data-index="0">
                  <h2>Para mi Salomé ♥</h2>
                  <p class="meta">Hoy celebramos 9 meses — abre la carta para más sorpresas.</p>
                  <div class="doodles" aria-hidden="true">
                    <!-- inline SVG doodles -->
                    <svg width="64" height="32" viewBox="0 0 64 32" aria-hidden="true">
                      <path d="M6 22 Q20 6 34 22 Q48 6 58 22" stroke="#ffd2dc" stroke-width="2" fill="none" stroke-linecap="round"/>
                    </svg>
                    <svg width="40" height="34" viewBox="0 0 24 24" aria-hidden="true">
                      <path d="M12 21s-7.5-5.5-10-9c-2.5-3.2 0-6 2.5-6 2.2 0 3.6 1.6 4.5 2.6.9-1 2.3-2.6 4.5-2.6 2.5 0 5 2.8 2.5 6-2.5 3.5-10 9-10 9z" fill="#ff6b8a"/>
                    </svg>
                  </div>
                </div>

                <!-- PAGE 2: MENSAJE (revelado con efecto) -->
                <div class="page page-1" data-index="1">
                  <h2>Mi amor</h2>
                  <p class="msg-content" id="msg1">
                    <!-- EDITA AQUÍ: Mensaje -->
                    Salomé — hace 9 meses que llegaste y cambiaste todo con una sonrisa. Gracias por las pequeñas cosas, por la paciencia, por creer en mí. Cada momento contigo me inspira a ser mejor. Te prometo más canciones, más caminatas y más empanadas compartidas.
                  </p>
                </div>

                <!-- PAGE 3: DIBUJITOS / RECUERDOS -->
                <div class="page page-2" data-index="2">
                  <h2>Pequeños recuerdos</h2>
                  <div class="doodles" aria-hidden="true">
                    <!-- simple SVG icons -->
                    <svg width="72" height="48" viewBox="0 0 24 24"><path d="M3 7l9 6 9-6v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" fill="#fff3e6" stroke="#ffb3c2"/></svg>
                    <svg width="72" height="48" viewBox="0 0 24 24"><circle cx="12" cy="8" r="3" fill="#ffdfe8"/><path d="M6 20c2-2 6-2 12 0" stroke="#ffe6ec" fill="none"/></svg>
                    <svg width="72" height="48" viewBox="0 0 24 24"><path d="M12 3c-3 4-9 4-9 12 0 0 3-3 9-3s9 3 9 3c0-8-6-8-9-12z" fill="#ffe8f0"/></svg>
                  </div>
                  <p class="meta">Doble click en el cuerpo de la carta para editar el texto directamente.</p>
                </div>

                <!-- PAGE 4: FIRMA -->
                <div class="page page-3" data-index="3">
                  <h2>Con todo mi corazón</h2>
                  <p>Te amo,</p>
                  <div style="margin-top:8px">
                    <div id="signature" class="signature" aria-hidden="true">
                      Tu Parcero
                      <span class="wipe"></span>
                    </div>
                  </div>
                </div>

              </div>

              <!-- pager -->
              <div class="page-nav" style="width:100%;justify-content:center;">
                <button class="ghost" id="prevBtn" aria-label="Página anterior">◀</button>
                <div class="pager" id="pager" role="tablist" aria-label="Navegación páginas"></div>
                <button class="ghost" id="nextBtn" aria-label="Página siguiente">▶</button>
              </div>
            </div>
          </div>

          <!-- particles holder -->
          <div class="particles" id="particles" aria-hidden="true"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- RIGHT: Side controls -->
  <aside class="side" id="side" role="complementary">
    <h3>Actualización profesional</h3>
    <p>Mejoré estructura, micro-interacciones, páginas internas, doodles en SVG, firma con efecto "revelado" y accesibilidad (prefers-reduced-motion, aria-live).</p>
    <div style="display:flex;gap:8px;margin-top:8px;">
      <button class="btn" id="openBtn">Abrir / Cerrar</button>
      <button class="ghost" id="copyBtn" title="Copiar mensaje">Copiar</button>
      <button class="ghost" id="editBtn" title="Editar">Editar</button>
    </div>
    <div style="margin-top:12px">
      <div class="icons">
        <button class="ghost" id="heartsBtn" title="Enviar corazones">❤</button>
        <button class="ghost" id="confettiBtn" title="Confetti">✺</button>
        <button class="ghost" id="printBtn" title="Imprimir">🖨️</button>
      </div>
    </div>

    <p style="margin-top:12px;color:var(--muted);font-size:13px">Personaliza el texto en la <code>&lt;div id="msg1"&gt;</code> o doble click sobre el párrafo para editar.</p>
  </aside>
</div>

<!-- sparkle cursor -->
<div id="spark" class="spark" style="display:none"></div>

<script>
  // ====== Helpers & state
  const envelope = document.getElementById('envelope');
  const envFlap = envelope.querySelector('.env-flap');
  const paper = document.getElementById('paper');
  const pages = Array.from(document.querySelectorAll('.page'));
  const pager = document.getElementById('pager');
  const particles = document.getElementById('particles');
  const spark = document.getElementById('spark');
  const openBtn = document.getElementById('openBtn');
  const copyBtn = document.getElementById('copyBtn');
  const editBtn = document.getElementById('editBtn');
  const heartsBtn = document.getElementById('heartsBtn');
  const confettiBtn = document.getElementById('confettiBtn');
  const printBtn = document.getElementById('printBtn');
  const signature = document.getElementById('signature');
  const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  let isOpen = false;
  let current = 0;

  // Build pager (dots)
  pages.forEach((p,i)=>{
    const dot = document.createElement('button');
    dot.className = 'dot' + (i===0? ' active':'');
    dot.setAttribute('role','tab');
    dot.setAttribute('aria-selected', i===0 ? 'true' : 'false');
    dot.addEventListener('click', ()=> showPage(i, true));
    pager.appendChild(dot);
  });

  // show page
  function showPage(index, userTriggered=false){
    if(index < 0) index = 0;
    if(index >= pages.length) index = pages.length-1;
    pages.forEach((p, i)=> {
      p.classList.toggle('active', i===index);
      const dot = pager.children[i];
      if(dot){ dot.classList.toggle('active', i===index); dot.setAttribute('aria-selected', i===index?'true':'false') }
    });
    current = index;
    // announce for assistive tech
    if(!prefersReduced){
      const live = paper; // paper has aria-live
      live.textContent = live.textContent; // trivial update to trigger polite read
    }
    // signature reveal on final page
    if(index === pages.length-1 && !prefersReduced){
      setTimeout(()=>signature.classList.add('revealed'), 450);
    } else {
      signature.classList.remove('revealed');
    }
  }

  // envelope toggle
  function toggleEnvelope(triggeredByUser=false){
    isOpen = !isOpen;
    envelope.classList.toggle('open', isOpen);
    envelope.setAttribute('aria-pressed', String(isOpen));
    if(isOpen){
      spawnHearts(7);
      // reveal first message page with a small type effect (if not reduced)
      if(!prefersReduced) revealText(document.getElementById('msg1'));
      else document.getElementById('msg1').style.opacity = 1;
    }
  }

  // event handlers
  envelope.addEventListener('click', ()=> toggleEnvelope(true));
  envelope.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); toggleEnvelope(true); }});
  openBtn.addEventListener('click', ()=> toggleEnvelope(true));

  document.getElementById('prevBtn').addEventListener('click', ()=> showPage(current-1, true));
  document.getElementById('nextBtn').addEventListener('click', ()=> showPage(current+1, true));

  // double click edit
  const msg1 = document.getElementById('msg1');
  msg1.addEventListener('dblclick', ()=>{
    const newVal = prompt('Editar mensaje (texto simple):', msg1.innerText.trim());
    if(newVal !== null) msg1.innerText = newVal;
  });
  editBtn.addEventListener('click', ()=> {
    const newVal = prompt('Editar mensaje (texto simple):', msg1.innerText.trim());
    if(newVal !== null) msg1.innerText = newVal;
  });

  // copy button
  copyBtn.addEventListener('click', async ()=>{
    try{
      await navigator.clipboard.writeText(msg1.innerText);
      alert('Mensaje copiado al portapapeles.');
    }catch(e){
      alert('No se pudo copiar automáticamente. Selecciona y copia manualmente.');
    }
  });

  // print
  printBtn.addEventListener('click', ()=> window.print());

  // spawn hearts
  function spawnHearts(n=6){
    for(let i=0;i<n;i++){
      const el = document.createElement('div');
      el.className = 'heart';
      el.style.left = (40 + Math.random()*280) + 'px';
      el.style.bottom = (20 + Math.random()*20) + 'px';
      el.innerHTML = '<svg viewBox="0 0 24 24" width="22" height="22"><path d="M12 21s-7.5-5.5-10-9c-2.5-3.2 0-6 2.5-6 2.2 0 3.6 1.6 4.5 2.6.9-1 2.3-2.6 4.5-2.6 2.5 0 5 2.8 2.5 6-2.5 3.5-10 9-10 9z" fill="#ff6b8a"></path></svg>';
      particles.appendChild(el);
      setTimeout(()=> el.remove(), 1600 + i*300);
    }
  }

  heartsBtn.addEventListener('click', ()=> spawnHearts(10));

  // confetti (simple squares)
  confettiBtn.addEventListener('click', ()=>{
    for(let i=0;i<30;i++){
      const c = document.createElement('div');
      c.style.position='fixed';
      c.style.left = Math.random()*100 + 'vw';
      c.style.top = Math.random()*100 + 'vh';
      c.style.width = '8px';
      c.style.height = '8px';
      const colors = ['#ff6b8a','#ffd36b','#9ee3ff','#b29bff'];
      c.style.background = colors[Math.floor(Math.random()*colors.length)];
      c.style.zIndex = 9999;
      document.body.appendChild(c);
      c.animate([{transform:'translateY(0) rotate(0deg)', opacity:1},{transform:`translateY(${200+Math.random()*260}px) rotate(${Math.random()*360}deg)`, opacity:0}],{duration:1100+Math.random()*1200, easing:'cubic-bezier(.2,.8,.2,1)'});
      setTimeout(()=>c.remove(), 2400);
    }
  });

  // basic cursor sparkle
  document.addEventListener('mousemove',(e)=>{
    if(prefersReduced) return;
    spark.style.display='block';
    spark.style.left = e.clientX + 'px';
    spark.style.top = e.clientY + 'px';
    spark.style.width = (6 + Math.random()*18) + 'px';
    spark.style.height = spark.style.width;
  });
  document.addEventListener('mouseleave', ()=> spark.style.display='none');

  // simple reveal text (letter by letter)
  function revealText(el){
    const text = el.innerText.trim();
    el.innerText = '';
    let i=0;
    const speed = 18; // ms per char
    function step(){
      if(i < text.length){
        el.innerText += text.charAt(i);
        i++;
        setTimeout(step, speed + Math.random()*20);
      }
    }
    step();
  }

  // on load small entrance
  window.addEventListener('load', ()=>{
    envelope.animate([{transform:'translateY(12px)'},{transform:'translateY(0)'}],{duration:600,easing:'cubic-bezier(.2,.9,.2,1)'});
    // prepopulate text if reduced motion
    if(prefersReduced){
      pages.forEach(p=>p.style.opacity = 1);
    }
  });

  // keyboard page navigation
  document.addEventListener('keydown',(e)=>{
    if(e.key === 'ArrowRight') showPage(current+1, true);
    if(e.key === 'ArrowLeft') showPage(current-1, true);
    if(e.key === 'Escape' && isOpen) toggleEnvelope(true);
  });

  // make initial page dots correct
  showPage(0);

</script>
</body>
</html>
